# Okta Automation Example

csv 파일과 cron job을 이용하여 정해진 시간에 Okta API를 자동으로 호출하여 필요한 작업을 수행하고 로그를 남기는 예시입니다. 구체적으로는 사용자명과 그룹명, 그리고 그룹 멤버십 만료 기간이 담긴 csv파일을 바탕으로 매일 정해진 시각 (새벽 1시)에 Okta API를 호출하여 멤버십 만료 기간이 지난 사용자를 해당 그룹에서 삭제하는 프로세스가 수행됩니다.

## 설치

이 프로그램을 사용하기 위해서는 사용자의 환경에 Node.js가 설치되어 있어야 합니다.

Nodejs.org에서 플랫폼에 맞는 Node 설치: https://nodejs.org/ko/download/

Node가 설치되었다면 이 repository를 clone하시거나, 혹은 ZIP 파일로 다운로드 받아서 적당한 장소에 압축을 풀어주세요.

프로젝트의 메인 폴더에서 아래와 같이 입력하여 필요한 패키지들을 설치해 줍니다.

```
npm install
```

## Data 파일 준비

프로젝트 메인 폴더 아래에 `data` 폴더를 열어보시면, `membersUntil.csv` 파일이 있습니다. 작업 대상이 되는 사용자의 유저명, 그룹명, 멤버십 만료 기간을 포맷에 맞게 입력하여 주세요. Excel을 사용하는 경우, 꼭 .csv 포맷으로 저장하시기 바랍니다. 또한 날짜 포맷을 가급적 'YYYY-MM-DD'로 맞추어 주세요. (Moment.js 라이브러리로 변환을 합니다만 가끔 이상한 포맷이 들어오면 투덜거립니다.)

## 실행

Data 파일이 준비되었으면 아래의 명령어로 실행합니다.

```
npm run start
```

아마 아무 일도 일어나지 않을 것입니다. 현재 설정은 매일 새벽 1시에 스크립트가 돌도록 되어 있기 때문입니다. 처음 테스트를 하실 때에는 `index.js`를 열어서 18번째 줄의 cron schedule을 `0 * * * * *`으로 놓고 실행하시면 1분에 한 번씩 스크립트가 돌아갑니다. (매분 0초 시점에)

## 참고사항

Okta API에는 Rate Limit이 적용되어 있기 때문에, 스크립트가 실행간격 없이 연속적으로 실행되면 이러한 Limit의 영향을 받아 작업이 제대로 수행되지 않을 수 있습니다. 이 스크립트에서는 그러한 상황을 방지하기 위해, 각 사용자 당 3번의 API call을 통한 작업이 완료된 후, 2초 정도 기다렸다가 다음 작업이 수행되도록 구성하였습니다.
